<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>מדריך דרגות</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand-left">
        <a class="btn ghost" href="index.html">חזרה</a>
        <a class="btn primary" href="booklet.html">חוברת להדפסה</a>
      </div>

      <div class="brand-center">
        <div class="brand-title" data-brand="groupName">המסע המשותף שלנו</div>
        <div class="brand-sub" data-brand="subtitle">חוברת הדרגות – מדריך וידאו לזכיין חדש</div>
      </div>

      <div class="brand-right">
        <img id="brandLogo" class="brand-logo" alt="logo" src="assets/ourway.jpg" />
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h1 id="rankTitle" class="rankTitle">דרגה</h1>
      <p id="rankIntro" class="rankIntro"></p>
    </section>

    <section class="card">
      <h2 class="sectionTitle">סרטון דרגה</h2>
      <div class="videoWrap">
        <iframe id="rankVideo" class="videoFrame" src="" title="YouTube video" allowfullscreen></iframe>
      </div>
      <div class="videoLink" id="rankVideoLink"></div>
    </section>

    <section class="card">
      <h2 class="sectionTitle">מה חשוב לנקודה בדרגה הזו</h2>
      <ul id="rankBullets" class="bullets"></ul>
    </section>

    <section class="card">
      <h2 class="sectionTitle">עץ התקדמות לדרגה</h2>
      <div id="rankTreeMount"></div>
    </section>
  </main>

  <script src="brands.js"></script>
  <script src="data.js"></script>
  <script src="rank-tree.js"></script>

  <script>
    (function () {
      function toEmbedUrl(youtubeUrl) {
        if (!youtubeUrl) return "";
        // supports youtu.be/ID or youtube.com/watch?v=ID
        let id = "";
        try {
          const u = new URL(youtubeUrl);
          if (u.hostname.includes("youtu.be")) {
            id = u.pathname.replace("/", "");
          } else {
            id = u.searchParams.get("v") || "";
          }
        } catch (e) {
          return "";
        }
        return id ? ("https://www.youtube.com/embed/" + id) : "";
      }

      function getRankId() {
        return new URLSearchParams(location.search).get("id");
      }

      function initRankPage() {
        const id = getRankId();
        const rank = (window.RANKS || []).find(r => r.id === id);
        if (!rank) {
          document.getElementById("rankTitle").textContent = "שגיאה: דרגה לא נמצאה";
          return;
        }

        document.getElementById("rankTitle").textContent = rank.title;
        document.getElementById("rankIntro").textContent = rank.intro || "";

        const embed = toEmbedUrl(rank.videoUrl);
        const iframe = document.getElementById("rankVideo");
        iframe.src = embed;

        const linkBox = document.getElementById("rankVideoLink");
        linkBox.innerHTML = rank.videoUrl
          ? `קישור לסרטון: <a href="${rank.videoUrl}" target="_blank" rel="noopener">${rank.videoUrl}</a>`
          : "";

        const ul = document.getElementById("rankBullets");
        ul.innerHTML = "";
        (rank.bullets || []).forEach(b => {
          const li = document.createElement("li");
          li.textContent = b;
          ul.appendChild(li);
        });

        // apply branding (existing behavior)
        if (window.applyBranding) window.applyBranding();
      }

      document.addEventListener("DOMContentLoaded", initRankPage);
    })();
  </script>
</body>
</html>
