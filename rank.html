<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>דרגה</title>
  <link rel="stylesheet" href="style.css?v=FINAL_LOC">
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand-left"><a class="btn ghost" href="index.html">חזרה</a></div>
      <div class="brand-center"><div class="brand-logo"><img data-brand="logo" style="display:none"><span data-brand="logoFallback">LOGO</span></div></div>
    </div>
  </header>
  
  <main class="container">
    <nav class="rank-nav-container no-print" style="margin-bottom:20px; overflow-x:auto;">
       <div id="rankNav" class="rank-nav-buttons" style="display:flex; gap:10px;"></div>
    </nav>

    <div class="rank-text-area">
      <section class="card"><h1 id="rankTitle">...</h1><p id="rankIntro"></p></section>
      
      <section class="card videoWrap"><iframe id="rankVideo" class="videoFrame" allowfullscreen></iframe></section>
      
      <section class="card"><ul id="rankBullets" class="bullets"></ul></section>

      <section class="card tree-card-container">
        <h2 class="sectionTitle">מבנה העץ</h2>
        <div id="rankTreeMount"></div>
      </section>
    </div>
  </main>

  <script src="brand-core.js?v=FINAL_LOC"></script>
  <script src="data.js?v=FINAL_LOC"></script>
  <script src="rank-tree.js?v=FINAL_LOC"></script>
  
  <script>
    document.addEventListener("DOMContentLoaded", () => {
        const id = new URLSearchParams(location.search).get("id");
        const nav = document.getElementById("rankNav");
        if(nav && window.RANKS) {
            nav.innerHTML = "";
            window.RANKS.forEach(r => {
                const a = document.createElement("a");
                a.className = "nav-chip"; a.style.padding="8px 15px"; a.style.background="#fff"; a.style.border="1px solid #ccc"; a.style.borderRadius="20px"; a.style.textDecoration="none"; a.style.color="#333";
                if(r.id === id) { a.style.background = "#16a34a"; a.style.color = "white"; }
                a.href = `rank.html?id=${r.id}`;
                a.textContent = r.nodeCode || r.title;
                nav.appendChild(a);
            });
        }
        const r = (window.RANKS||[]).find(x => x.id === id);
        if(!r) return;
        document.getElementById("rankTitle").textContent = r.title;
        document.getElementById("rankIntro").textContent = r.intro;
        if(r.videoUrl) document.getElementById("rankVideo").src = "https://www.youtube.com/embed/" + r.videoUrl.split("/").pop().split("?")[0];
        const ul = document.getElementById("rankBullets");
        if(r.bullets) { ul.innerHTML = ""; r.bullets.forEach(b => { const li = document.createElement("li"); li.textContent = b; ul.appendChild(li); }); }
    });
  </script>
</body>
</html>
