<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>专</title>
  <link rel="stylesheet" href="style.css?v=RESTORE_OK" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .calc-card { background: #f0f9ff; border: 2px solid #bae6fd; padding: 25px; margin-top: 20px; border-radius: 12px; }
    .calc-header { font-size: 1.3rem; font-weight: 800; color: #0369a1; margin-bottom: 10px; }
    .calc-row { display: flex; gap: 10px; margin-bottom: 15px; }
    .calc-input { flex: 1; padding: 12px; border: 1px solid #94a3b8; border-radius: 8px; font-size: 1rem; }
    .calc-btn { background: #0284c7; color: white; padding: 12px 25px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    .calc-result { background: #ffffff; border: 1px solid #e2e8f0; padding: 20px; border-radius: 8px; display: none; text-align: center; margin-top: 15px; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand-left"><a class="btn ghost" href="index.html">专</a></div>
      <div class="brand-center"><div class="brand-title">驻专 专</div></div>
    </div>
  </header>
  <main class="container">
    <div class="rank-text-area">
      <section class="card"><h1 id="rankTitle">...</h1><p id="rankIntro"></p></section>
      <section class="calc-card">
        <div class="calc-header">М 砖</div>
        <div style="margin-bottom:10px;">注: <b id="targetPointsDisplay">0</b></div>
        <div class="calc-row"><input type="number" id="currentPointsInput" class="calc-input" placeholder="拽转 拽转"></div>
        <div class="calc-row"><select id="strategySelect" class="calc-input"><option>专 </option></select><button class="calc-btn" onclick="calc()">砖</button></div>
        <div id="calcResult" class="calc-result"></div>
      </section>
      <section class="card videoWrap"><iframe id="rankVideo" class="videoFrame" allowfullscreen></iframe></section>
      <section class="card"><h2 class="sectionTitle">砖</h2><ul id="rankBullets" class="bullets"></ul></section>
    </div>
    <section class="card tree-card-container"><h2 class="sectionTitle"> 注抓</h2><div id="rankTreeMount"></div></section>
  </main>
  <script src="data.js?v=RESTORE_OK"></script>
  <script src="rank-tree.js?v=RESTORE_OK"></script>
  <script>
    function calc() {
        const cur = parseFloat(document.getElementById("currentPointsInput").value) || 0;
        const pts = parseFloat(document.getElementById("strategySelect").value);
        const r = (window.RANKS||[]).find(x => x.id === new URLSearchParams(location.search).get("id"));
        if(!r || !pts) return;
        const mis = Math.max(0, r.targetPoints - cur);
        const need = Math.ceil(mis / pts);
        const res = document.getElementById("calcResult");
        res.style.display = "block";
        res.innerHTML = mis <= 0 ? "注 砖!" : `住专: <b>${mis.toLocaleString()}</b><br>爪专 专: <b>${need}</b> 转`;
    }
    document.addEventListener("DOMContentLoaded", () => {
        const id = new URLSearchParams(location.search).get("id");
        const r = (window.RANKS||[]).find(x => x.id === id);
        if(!r) return;
        document.getElementById("rankTitle").textContent = r.title;
        document.getElementById("rankIntro").textContent = r.intro;
        document.getElementById("rankVideo").src = r.videoUrl ? "https://www.youtube.com/embed/" + r.videoUrl.split("/").pop().split("?")[0] : "";
        if(r.targetPoints) document.getElementById("targetPointsDisplay").textContent = r.targetPoints.toLocaleString();
        
        const ul = document.getElementById("rankBullets");
        (r.bullets||[]).forEach(b => { const li = document.createElement("li"); li.textContent = b; ul.appendChild(li); });
        
        const sel = document.getElementById("strategySelect");
        (window.STRATEGIES||[]).forEach(s => { const o = document.createElement("option"); o.value = s.points; o.textContent = s.name; sel.appendChild(o); });
    });
  </script>
</body>
</html>
